---
title: Shell小记
date: 2016-04-20 17:40:00
tags:
- shell
- linux


---
### 文件管理
在某些场景中，需要统计一个文件夹下的所有文件大小，或者对它们排序。例如在一些安全软件中，常常有垃圾清理，文件整理这样的功能。这里做了一道题目，将一个文件夹中包含的所有文件(包含子文件夹下)按照大小进行排序。  
这里最后我的答案是

	find . -type f -exec ls -lh {} \;|sort -k 5
	
似乎并不是最好的答案。  
使用shell的话，利用ls是比较好的选择。在ls命令中，-S选项能够直接提供文件大小的排序，但问题在于，它不能把所有文件进行排序，只能在每个文件夹下进行排序；而且对于多个文件，ls无法显示文件的路径。所以这里使用了find。find -type能够指定文件的类型，这里指定查询的类型为文件(非目录)。然后sort -k指定了进行排序为第5列。这里exec的使用方法如下：

	-exec <command> {result} \;
	
花括号{}代表find所查找出来的文件名，它的终止是以;为结束标志的，而这里的\起到了转义字符的作用。  
除了我所使用的方法，我还参考了一下其他人的答案。有一种利用xargs的:

	find . -type f|xargs ls -lh|sort -k 5
	
xargs能够把不支持管道传递的参数传递给下一个命令，通常用空白字符作为分隔。

### 日志访客数量统计
在网站的统计中，有时候需要通过日志来计算某一天的访客数量。这里有一个文件，它记录了某一天的访客记录，其中包含了访问时间，其第2项为访客的ID。那么如何确定访客数量呢？我做的答案是

	grep "2015-08-24" log.txt|sort -k 2 -nu|wc -l
	
wc命令用于统计某个文件中的字结束、字数和行数。其中-l为显示行数的命令。这里首先用grep筛选出2015-8-24的日志内容，然后对第二项进行排序，sort -u去除了重复项。然后用wc -l就统计出了这一天的访客数量。